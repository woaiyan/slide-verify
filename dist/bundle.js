!function(t){"function"==typeof define&&define.amd?define(t):t()}((function(){"use strict";class t extends HTMLElement{root=null;canvas=null;slideBar=null;slideGroove=null;isReady=!1;width=500;height=300;image_url="";image=null;ctx=null;isDrag=!1;maxOffset=4;gapPosition={x:0,y:0};blockPosition={x:0,y:0};gapPath=new Path2D("");static get observedAttributes(){return["width","height","image"]}constructor(){super();const t=this.attachShadow({mode:"open"}),i=document.createElement("div");i.innerHTML='<style>\r\n    .slide-verify-wrapper{\r\n        position: relative;\r\n    }\r\n    .slide-verify-groove{\r\n        width: 100%;\r\n        height: 40px;\r\n        border: #ebebeb solid thin;\r\n        box-sizing: border-box;\r\n    }\r\n    .slide-verify-bar{\r\n        width: 34px;\r\n        height: 34px;\r\n        margin: 2px;\r\n        border-radius: 2px;\r\n        cursor: move;\r\n        background: #d0d0d0;\r\n        position: relative\r\n    }\r\n    .slide-verify-bar::after{\r\n        content: \' \';\r\n        position: absolute;\r\n        width: 100%;\r\n        height: 100%;\r\n        background:\r\n                radial-gradient(circle at 30% 30%, #e9e9e9 2px, transparent 3px),\r\n                radial-gradient(circle at 50% 30%, #e9e9e9 2px, transparent 3px),\r\n                radial-gradient(circle at 70% 30%, #e9e9e9 2px, transparent 3px),\r\n                radial-gradient(circle at 30% 50%, #e9e9e9 2px, transparent 3px),\r\n                radial-gradient(circle at 50% 50%, #e9e9e9 2px, transparent 3px),\r\n                radial-gradient(circle at 70% 50%, #e9e9e9 2px, transparent 3px),\r\n                radial-gradient(circle at 30% 70%, #e9e9e9 2px, transparent 3px),\r\n                radial-gradient(circle at 50% 70%, #e9e9e9 2px, transparent 3px),\r\n                radial-gradient(circle at 70% 70%, #e9e9e9 2px, transparent 3px);\r\n    }\r\n</style>\r\n<div class="slide-verify-wrapper">\r\n    <canvas></canvas>\r\n    <div class="slide-verify-groove">\r\n        <div class="slide-verify-bar"></div>\r\n    </div>\r\n</div>\r\n';const e=i.childNodes;for(let i=0;i<e.length;i++)t.appendChild(e[i]);this.root=this.shadowRoot?.querySelector(".slide-verify-wrapper"),this.canvas=this.shadowRoot?.querySelector("canvas"),this.slideBar=this.shadowRoot?.querySelector(".slide-verify-bar"),this.slideGroove=this.shadowRoot?.querySelector(".slide-verify-groove"),this.ctx=this.canvas?.getContext("2d")}updateSize(){this.root.style.width=`${this.width}px`,this.canvas?.setAttribute("width",this.width),this.canvas?.setAttribute("height",this.height)}updateStyle(){this.slideGroove.style=`background: linear-gradient(90deg, #f3f3f3 ${this.blockPosition.x}px, white ${this.blockPosition.x}px);`,this.slideBar.style=`transform: translateX(${this.blockPosition.x}px);background: #bbbbbb;`}verify=()=>{this.isReady=!1;const t=Math.abs(this.gapPosition.x-this.blockPosition.x);t<=this.maxOffset?this.slideGroove.style=`\n          background: linear-gradient(90deg, #daffda ${this.blockPosition.x}px, white ${this.blockPosition.x}px);\n        `:this.slideGroove.style=`\n          background: linear-gradient(90deg, #ffd9d9 ${this.blockPosition.x}px, white ${this.blockPosition.x}px);\n        `;const i=new CustomEvent("verify",{detail:t<=this.maxOffset});this.dispatchEvent(i)};reset=()=>{this.updateSize(),this.image=new Image,this.image.src=this.image_url,this.image.onload=()=>{this.slideGroove.style="",this.gapPosition={x:Math.floor(Math.random()*(this.width-40)),y:Math.floor(Math.random()*(this.height-40))},this.blockPosition={x:0,y:0},this.draw(),this.initEvent(),this.isReady=!0}};handleDrag=t=>{if(!this.isReady||!this.isDrag)return null;const i=t.movementX;this.blockPosition.x=Math.min(Math.max(this.blockPosition.x+i,0),this.width-40),requestAnimationFrame(this.draw)};handleMouseup=()=>{this.isDrag=!1,this.isReady=!1,this.verify(),document.removeEventListener("mousemove",this.handleDrag),document.removeEventListener("mouseup",this.handleMouseup)};handleMousedown=t=>{!this.isReady||t.target!==this.canvas&&t.target!==this.slideBar||(this.isDrag=!0,document.addEventListener("mousemove",this.handleDrag),document.addEventListener("mouseup",this.handleMouseup))};initEvent(){this.root.addEventListener("mousedown",this.handleMousedown),this.addEventListener("reset",(()=>{this.reset()}))}draw=()=>{this.ctx.strokeStyle="black",this.ctx.clearRect(0,0,this.width,this.height),this.ctx.drawImage(this.image,0,0,this.width,this.height),this.ctx.save(),this.ctx.setTransform(.044,0,0,.044,this.gapPosition.x,this.gapPosition.y),this.ctx.fillStyle="rgba(0,0,0,0.5)",this.ctx.lineWidth=20,this.ctx.stroke(this.gapPath),this.ctx.fill(this.gapPath),this.ctx.restore(),this.ctx.save(),this.ctx.setTransform(.044,0,0,.044,this.blockPosition.x,this.gapPosition.y),this.ctx.clip(this.gapPath),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.image,-(this.gapPosition.x-this.blockPosition.x),0,this.width,this.height),this.ctx.restore(),this.ctx.save(),this.ctx.setTransform(.044,0,0,.044,this.blockPosition.x,this.gapPosition.y),this.ctx.strokeStyle="white",this.ctx.lineWidth=20,this.ctx.stroke(this.gapPath),this.ctx.restore(),this.updateStyle()};disconnectedCallback(){console.log("slide verify disconnectedCallback")}connectedCallback(){this.width=this.getAttribute("width"),this.height=this.getAttribute("height"),this.image_url=this.getAttribute("image"),this.reset()}}customElements.define("verify-component",t)}));
